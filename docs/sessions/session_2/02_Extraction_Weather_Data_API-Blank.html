<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Immanuel Williams &amp; Ciera Millard">
<meta name="dcterms.date" content="2025-07-22">

<title>Session 2: Weather Data - OpenWeatherAPI Fill-In (EMPTY) â€“ Data Extraction Workshop (USCOTS 2025)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-6bd9cfa162949bde0a231f530c97869d.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Data Extraction Workshop (USCOTS 2025)</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-sessions" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Sessions</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-sessions">    
        <li>
    <a class="dropdown-item" href="../../sessions/session_1/01_Extraction_Introduction.html">
 <span class="dropdown-text">Session 1 - Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../sessions/session_1/libraries_of_packages.html">
 <span class="dropdown-text">Libraries &amp; Packages</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../sessions/session_2/02_Extraction_Weather_Data_API.html">
 <span class="dropdown-text">Session 2 - Weather API</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../sessions/session_3/03_Extraction_of_Data_NFL_HTML.html">
 <span class="dropdown-text">Session 3 - NFL HTML</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../sessions/session_4/04_Extraction_FinalActivity.html">
 <span class="dropdown-text">Session 4 - Final Activity</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-outlines" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Outlines</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-outlines">    
        <li>
    <a class="dropdown-item" href="../../outlines_and_organization/organized-outline.html">
 <span class="dropdown-text">Organized Outline</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#session-2-extracting-data-using-apis" id="toc-session-2-extracting-data-using-apis" class="nav-link active" data-scroll-target="#session-2-extracting-data-using-apis">Session 2: Extracting data using APIs</a>
  <ul class="collapse">
  <li><a href="#part-1.-goals-objectives" id="toc-part-1.-goals-objectives" class="nav-link" data-scroll-target="#part-1.-goals-objectives">Part 1. Goals &amp; Objectives</a></li>
  <li><a href="#part-2.-conceptual-foundation" id="toc-part-2.-conceptual-foundation" class="nav-link" data-scroll-target="#part-2.-conceptual-foundation">Part 2. Conceptual Foundation</a>
  <ul class="collapse">
  <li><a href="#what-is-an-api-again" id="toc-what-is-an-api-again" class="nav-link" data-scroll-target="#what-is-an-api-again">1. What is an API (again)?</a></li>
  <li><a href="#api-logic" id="toc-api-logic" class="nav-link" data-scroll-target="#api-logic">2. API Logic</a></li>
  <li><a href="#requests-and-responses" id="toc-requests-and-responses" class="nav-link" data-scroll-target="#requests-and-responses">3. Requests and Responses</a></li>
  <li><a href="#anatomy-of-json" id="toc-anatomy-of-json" class="nav-link" data-scroll-target="#anatomy-of-json">4. Anatomy of JSON</a></li>
  <li><a href="#status-code" id="toc-status-code" class="nav-link" data-scroll-target="#status-code">5. Status Code</a></li>
  <li><a href="#crud-framework" id="toc-crud-framework" class="nav-link" data-scroll-target="#crud-framework">6. CRUD Framework</a></li>
  <li><a href="#get-request" id="toc-get-request" class="nav-link" data-scroll-target="#get-request">7. GET Request</a></li>
  <li><a href="#p8.-post-request" id="toc-p8.-post-request" class="nav-link" data-scroll-target="#p8.-post-request">P8. Post Request</a></li>
  <li><a href="#setup-api_key" id="toc-setup-api_key" class="nav-link" data-scroll-target="#setup-api_key">9. Setup <code>API_Key</code></a></li>
  <li><a href="#requests-urls-queries" id="toc-requests-urls-queries" class="nav-link" data-scroll-target="#requests-urls-queries">10. Requests, URLs &amp; Queries</a></li>
  <li><a href="#what-happens-under-the-hood" id="toc-what-happens-under-the-hood" class="nav-link" data-scroll-target="#what-happens-under-the-hood">11: What Happens Under the Hood</a></li>
  <li><a href="#two-ways-to-build-request-objects" id="toc-two-ways-to-build-request-objects" class="nav-link" data-scroll-target="#two-ways-to-build-request-objects">12. Two Ways to Build Request Objects</a></li>
  <li><a href="#lets-dissect-build-a-function-1" id="toc-lets-dissect-build-a-function-1" class="nav-link" data-scroll-target="#lets-dissect-build-a-function-1">13. Letâ€™s dissect &amp; build a function 1</a></li>
  <li><a href="#lets-dissect-build-a-function-2" id="toc-lets-dissect-build-a-function-2" class="nav-link" data-scroll-target="#lets-dissect-build-a-function-2">14. Letâ€™s dissect &amp; build a function 2</a></li>
  </ul></li>
  <li><a href="#part-3.-hands-on-activities" id="toc-part-3.-hands-on-activities" class="nav-link" data-scroll-target="#part-3.-hands-on-activities">Part 3. Hands on Activities</a></li>
  <li><a href="#part-4.-reflection" id="toc-part-4.-reflection" class="nav-link" data-scroll-target="#part-4.-reflection">Part 4. Reflection</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Session 2: Weather Data - OpenWeatherAPI Fill-In (EMPTY)</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Immanuel Williams &amp; Ciera Millard </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">July 22, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<!-- Delete this in Python Note Books -->
<section id="session-2-extracting-data-using-apis" class="level1">
<h1>Session 2: Extracting data using APIs</h1>
<section id="part-1.-goals-objectives" class="level2">
<h2 class="anchored" data-anchor-id="part-1.-goals-objectives">Part 1. Goals &amp; Objectives</h2>
<p>By the end of this session, participants will be able to:</p>
<ol type="1">
<li><p><strong>Understand the foundational concepts of APIs</strong> as a bridge for data exchange, including how they function in modern software and support real-time data extraction.</p></li>
<li><p><strong>Query public APIs effectively</strong>, forming well-structured requests that interact with remote databases and return meaningful results.</p></li>
<li><p><strong>Interpret JSON responses</strong>, with a focus on the <strong>data</strong> element, while also distinguishing between <strong>metadata</strong> and <strong>status codes</strong>. Develop an understanding of how HTTP status codes and API keys work to validate and secure data access.</p></li>
<li><p><strong>Write clean, purposeful R code</strong> to send API requests, handle responses, and parse structured data into tidy, analyzable formats.</p></li>
</ol>
<div style="height: 300px; background-color: white;">

</div>
</section>
<section id="part-2.-conceptual-foundation" class="level2">
<h2 class="anchored" data-anchor-id="part-2.-conceptual-foundation">Part 2. Conceptual Foundation</h2>
<p>Part A. Theoretical ideas of APIs</p>
<p>Note 1:</p>
<ul>
<li>This is not a webdeveloper nor a CS course but with a decent understanding of the logic, you and your students will appreciate the utilizartion of web scrapiing more</li>
</ul>
<section id="what-is-an-api-again" class="level3">
<h3 class="anchored" data-anchor-id="what-is-an-api-again">1. What is an API (again)?</h3>
<p>It is the ability for software to communicate</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://phoenixnap.com/kb/wp-content/uploads/2022/11/cloud-api-request-and-response.png" class="img-fluid figure-img" width="459"></p>
<figcaption>API Call (PhoenixNap.com)</figcaption>
</figure>
</div>
<p>####â€”â€”â€”â€”â€”â€”â€”</p>
<section id="q1." class="level4">
<h4 class="anchored" data-anchor-id="q1.">Q1.</h4>
<p><strong>(Multiple Choice):</strong> What is the primary utility of a web API for a data analyst? a) To create visual websites for data projects. b) To allow programmatic, repeatable, and direct access to live data from an external source. c) To store large CSV files in the cloud. d) To design the database structure for a server.</p>
<p>####â€”â€”â€”â€”â€”â€”â€”</p>
<p>Note 2:</p>
<ul>
<li><p>This image is overly simplified in that a client left makes request through an api to a server/database then the server/database provides responses</p></li>
<li><p>A client and server can exist on the same computer. This is often whatâ€™s happening in local development (e.g., querying a local database from R)</p></li>
</ul>
<div style="height: 300px; background-color: white;">

</div>
</section>
</section>
<section id="api-logic" class="level3">
<h3 class="anchored" data-anchor-id="api-logic">2. API Logic</h3>
<p>Lets go deeper into understanding Define:</p>
<p>Client (request) â€“&gt; API â€“&gt; Server â€“&gt; Database</p>
<p>Client &lt;â€“ API &lt;â€“ Server (response) &lt;â€“ Database</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/API-Request-Response.gif" class="img-fluid figure-img"></p>
<figcaption>GATO365 API Request &amp; Response</figcaption>
</figure>
</div>
<p>Note 3:</p>
<ul>
<li><p>Action: Client makes a request</p></li>
<li><p>Action: Server queries Database provides a response</p></li>
</ul>
<div style="height: 300px; background-color: white;">

</div>
<p>####â€”â€”â€”â€”â€”â€”â€”</p>
<section id="q2." class="level4">
<h4 class="anchored" data-anchor-id="q2.">Q2.</h4>
<p><strong>(Open-Ended):</strong> Using the restaurant analogy where the API is a <strong>waiter</strong>, describe the step-by-step process of you (the <strong>client</strong>) successfully ordering and receiving a â€œcurrent weather forecastâ€ from the kitchen (the <strong>server</strong>).</p>
<p>####â€”â€”â€”â€”â€”â€”â€”</p>
</section>
</section>
<section id="requests-and-responses" class="level3">
<h3 class="anchored" data-anchor-id="requests-and-responses">3. Requests and Responses</h3>
<p>Lets spend some more time on the request and response</p>
<p>The client sends a <code>request</code> asking for info (like Taylor Swift or todayâ€™s weather). This request includes:</p>
<ul>
<li>A URL (e.g., with parameters like ?q=San+Luis+Obispo)</li>
<li>Possibly an API key</li>
<li>A method (e.g., GET or POST)</li>
</ul>
<p>The request are in the form of a url string (more on this soonâ€¦)</p>
<p>The server then returns a <code>response</code> which contains:</p>
<ul>
<li>data (temperature, artist name, forecast, etc.)</li>
<li>metadata (This is information about the response.)</li>
<li>status code (Tells you whether the request was successful)</li>
</ul>
<p>This information is traditionally provided in JSON Format. (more on this soonâ€¦)</p>
<div style="height: 300px; background-color: white;">

</div>
<p>####â€”â€”â€”â€”â€”â€”â€”</p>
<section id="q3." class="level4">
<h4 class="anchored" data-anchor-id="q3.">Q3.</h4>
<p><strong>(Open-Ended):</strong> What is the fundamental difference between an API <strong>request</strong> and an API <strong>response</strong>? ğŸ¤”</p>
<p>####â€”â€”â€”â€”â€”â€”â€”</p>
</section>
</section>
<section id="anatomy-of-json" class="level3">
<h3 class="anchored" data-anchor-id="anatomy-of-json">4. Anatomy of JSON</h3>
<ul>
<li><p>Letâ€™s focus on what the response is 1st (what we receive from the server):</p></li>
<li><p>Below is an example GIF of the information sent from the server in JSON format:</p></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/Anatomy of a JSON Response.gif" class="img-fluid figure-img"></p>
<figcaption>GATO365 Anatomy JSON</figcaption>
</figure>
</div>
<p>Note 4:</p>
<ul>
<li>When we send a request to an API, we get a response body, which includes the content â€” typically JSON â€” divided into data (what we wanted), metadata (info about the data), and a status_code telling us if the request worked.</li>
</ul>
<div style="height: 300px; background-color: white;">

</div>
<p>####â€”â€”â€”â€”â€”â€”â€”</p>
<section id="q4." class="level4">
<h4 class="anchored" data-anchor-id="q4."><strong>Q4.</strong></h4>
<p><strong>(Multiple Choice):</strong> The JSON data format, commonly used in API responses, organizes information using what fundamental structure? a) Rows and columns b) A nested series of bullet points c) Key-value pairs d) Formatted paragraphs of text</p>
<p>####â€”â€”â€”â€”â€”â€”â€”</p>
</section>
</section>
<section id="status-code" class="level3">
<h3 class="anchored" data-anchor-id="status-code">5. Status Code</h3>
<p>Status codes tell you what happened with your request:</p>
<ul>
<li><p>100s: Info</p></li>
<li><p>200s: Success (highlight: 200 OK)</p></li>
<li><p>300s: Redirect</p></li>
<li><p>400s: Client error</p></li>
<li><p>500s: Server error</p></li>
</ul>
<p>Note 5:</p>
<ul>
<li>Emphasize: In most data APIs, your goal is to get a <strong>200</strong> response.</li>
<li>Use examples like making up a nonexistent city or artist to show how an API might respond with a 400 or 404. |</li>
</ul>
<p>** Client Request *************************</p>
<div style="height: 300px; background-color: white;">

</div>
<p>####â€”â€”â€”â€”â€”â€”â€”</p>
<section id="q5." class="level4">
<h4 class="anchored" data-anchor-id="q5."><strong>Q5.</strong></h4>
<p><strong>(Discussion):</strong> You write a script to get weather data, but it fails with a <code>404 Not Found</code> status code. Based on the 400-level error category, is it more likely that the weather companyâ€™s server is broken, or that you made a mistake? What part of your request is the most likely source of the error? ğŸ”</p>
<p>####â€”â€”â€”â€”â€”â€”â€”</p>
</section>
</section>
<section id="crud-framework" class="level3">
<h3 class="anchored" data-anchor-id="crud-framework">6. CRUD Framework</h3>
<p>What type of client requests can we make?</p>
<p><strong>CRUD Framework</strong> <em>(Create, Read, Update, Delete)</em></p>
<ul>
<li><p>Though APIs allow all four, <strong>Read</strong> (GET) is most common in data science.</p></li>
<li><p>RESTful API mapping:</p>
<ul>
<li><p><strong>Create â†’ POST</strong></p></li>
<li><p><strong>Read â†’ GET</strong></p></li>
<li><p><strong>Update â†’ PUT/PATCH</strong></p></li>
<li><p><strong>Delete â†’ DELETE</strong></p>
<p><img src="images/CRUD.jpeg" class="img-fluid" width="376"></p></li>
</ul></li>
</ul>
<p>Notes:</p>
<ul>
<li><p><strong>GET</strong> retrieves existing data from a server.</p></li>
<li><p><strong>POST</strong> submits new data to the server.</p></li>
<li><p><strong>UPDATE</strong> modifies existing data on the server.</p></li>
<li><p><strong>DELETE</strong> removes a resource from the server.</p></li>
<li><p>Sometimes we have to implement a post to be able to gain an access token</p></li>
</ul>
<div style="height: 300px; background-color: white;">

</div>
</section>
<section id="get-request" class="level3">
<h3 class="anchored" data-anchor-id="get-request">7. GET Request</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/Get-Request.gif" class="img-fluid figure-img"></p>
<figcaption>GATO365 Get Request</figcaption>
</figure>
</div>
<p>Here is the description of a GET request from that perspective.</p>
<ul>
<li><p><code>Client</code> <strong>constructs</strong> a <em>request</em> for a <em>resource</em>.</p></li>
<li><p><code>API</code> <strong>receives</strong> and <strong>validates</strong> the <code>client's</code> <em>request</em>.</p></li>
<li><p><code>Server</code> <strong>locates</strong> the requested <em>data</em> within <em>database</em>.</p></li>
<li><p><code>Client</code> <strong>receives</strong> requested <em>data</em> from the <em>server</em>.</p></li>
</ul>
<div style="height: 300px; background-color: white;">

</div>
<p>####â€”â€”â€”â€”â€”â€”â€”</p>
<section id="q6." class="level4">
<h4 class="anchored" data-anchor-id="q6."><strong>Q6.</strong></h4>
<p><strong>(Open-Ended):</strong> The session focuses on using a GET request to retrieve weather data. Describe another distinct example of a task a data scientist might perform using a <strong>GET</strong> request.</p>
<p>####â€”â€”â€”â€”â€”â€”â€”</p>
</section>
</section>
<section id="p8.-post-request" class="level3">
<h3 class="anchored" data-anchor-id="p8.-post-request">P8. Post Request</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/Post-Request.gif" class="img-fluid figure-img"></p>
<figcaption>GATO365 Post Request</figcaption>
</figure>
</div>
<ul>
<li>Here is the description of a POST request.
<ul>
<li><p><code>Client</code> <strong>sends</strong> new <em>data</em> within the <em>request</em> <code>body</code>.</p></li>
<li><p><code>API</code> <strong>receives</strong> and <strong>validates</strong> the <code>client's</code> new <em>data</em>.</p></li>
<li><p><code>Server</code> <strong>creates</strong> a new <em>record</em> in the <em>database</em>.</p></li>
<li><p><code>Client</code> <strong>receives</strong> a <em>confirmation</em> for the new <em>record</em>.</p></li>
</ul></li>
</ul>
<div style="height: 300px; background-color: white;">

</div>
<p>####â€”â€”â€”â€”â€”â€”â€” #### <strong>Q7.</strong></p>
<p><strong>(Multiple Choice):</strong> Which of the following data science tasks would most likely require a <strong>POST</strong> request instead of a GET request? a) Retrieving the current temperature for a city. b) Getting a list of your public repositories from the GitHub API. c) Submitting a new tweet through the X (formerly Twitter) API. d) Looking up the coordinates for a specific address.</p>
<p>####â€”â€”â€”â€”â€”â€”â€”</p>
</section>
<section id="setup-api_key" class="level3">
<h3 class="anchored" data-anchor-id="setup-api_key">9. Setup <code>API_Key</code></h3>
<hr>
<div style="height: 300px; background-color: white;">

</div>
<p>####â€”â€”â€”â€”â€”â€”â€”</p>
<section id="q8." class="level4">
<h4 class="anchored" data-anchor-id="q8."><strong>Q8.</strong></h4>
<p><strong>(Discussion):</strong> Why is it a critical security best practice to store your API key in an environment file (<code>.Renviron</code>) instead of writing it directly in your R script? Whatâ€™s the main risk of ignoring this practice? ğŸ”‘</p>
<p>####â€”â€”â€”â€”â€”â€”â€”</p>
</section>
</section>
<section id="requests-urls-queries" class="level3">
<h3 class="anchored" data-anchor-id="requests-urls-queries">10. Requests, URLs &amp; Queries</h3>
<ul>
<li><p>So what weâ€™re going to first do is create our request and the most ideal way.</p></li>
<li><p>A request <u><strong>defined by</strong></u> a <strong>URL</strong>, which contains both:</p>
<ul>
<li>The <em>endpoint</em> (base address of the API)</li>
<li>The <em>query string</em> (additional key-value pairs that modify the request)</li>
</ul></li>
<li><p>We often need to <strong>glue strings together</strong> to build this full URL dynamically.</p></li>
<li><p>A request is not â€œautomaticallyâ€ turned into JSON when sent â€” itâ€™s the <strong>response</strong> thatâ€™s usually formatted as JSON. The request is often URL-encoded if itâ€™s a GET.</p></li>
</ul>
<p>Note:</p>
<ul>
<li><p>An <strong>endpoint</strong> is the specific URL where an API can be accessed. Think of it as the main address for a particular set of resources. Itâ€™s the stable part of the URL that doesnâ€™t change from one request to the next.</p></li>
<li><p>A <strong>query string</strong> is used to customize the request by filtering or specifying the exact data you want from an endpoint. It always starts with a question mark (<code>?</code>) and is made up of key-value pairs.</p></li>
</ul>
<div style="height: 300px; background-color: white;">

</div>
<p>####â€”â€”â€”â€”â€”â€”â€” #### <strong>Q9.</strong></p>
<p><strong>(Open-Ended):</strong> In the URL <code>https://api.spotify.com/v1/search?q=Daft+Punk&amp;type=artist</code>, identify the <strong>endpoint</strong> and the two <strong>key-value pairs</strong> that make up the query string.</p>
<p>####â€”â€”â€”â€”â€”â€”â€”</p>
</section>
<section id="what-happens-under-the-hood" class="level3">
<h3 class="anchored" data-anchor-id="what-happens-under-the-hood">11: What Happens Under the Hood</h3>
<ul>
<li><p>When we use a URL like <code>...?q=San+Luis+Obispo&amp;appid=...</code>, weâ€™re constructing a <strong>query string</strong>, which is appended to the base URL.</p></li>
<li><p>Think of this as <em>â€œasking the questionâ€</em>â€”the query string shapes the request.</p></li>
<li><p>The server receives the request, processes it, and <strong>responds</strong> with structured data (typically JSON).</p></li>
<li><p>Weâ€™re not sending JSON in this caseâ€”weâ€™re sending a URL with parameters. JSON is <strong>returned to us</strong> as a response format.</p></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/URL-Anatomy.gif" class="img-fluid figure-img"></p>
<figcaption>GATO365 Post Request</figcaption>
</figure>
</div>
<p>Note 9:</p>
<ul>
<li><p>A <strong>URL</strong> is constructed from a <strong>base URL</strong> (the endpoint) and a <strong>query string</strong>.</p></li>
<li><p>The client sends a <strong>GET request</strong> using this URL to the API.</p></li>
<li><p>The API then relays this request to the server.</p></li>
<li><p>After processing the request, the server sends a <strong>response</strong>, which includes a status code and the requested data (often formatted as JSON), back to the client.</p></li>
</ul>
<div style="height: 300px; background-color: white;">

</div>
<p>####â€”â€”â€”â€”â€”â€”â€”</p>
<section id="q10." class="level4">
<h4 class="anchored" data-anchor-id="q10."><strong>Q10.</strong></h4>
<p><strong>(Multiple Choice):</strong> When your R script makes a <code>GET</code> request to the OpenWeather API, which statement is correct? a) Your script sends JSON and receives a URL. b) Your script sends a URL and receives JSON. c) Your script sends JSON and receives JSON. d) Your script sends a URL and receives a URL.</p>
<p>####â€”â€”â€”â€”â€”â€”â€”</p>
</section>
</section>
<section id="two-ways-to-build-request-objects" class="level3">
<h3 class="anchored" data-anchor-id="two-ways-to-build-request-objects">12. Two Ways to Build Request Objects</h3>
<section id="method-1-manual-string-gluing" class="level4">
<h4 class="anchored" data-anchor-id="method-1-manual-string-gluing"><strong>Method 1: Manual String Gluing</strong></h4>
<p>Load Libraries</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">## EMPTY VERSION</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># library(____)</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># library(____)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Specify city to query</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="do">## EMPTY VERSION</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># city_name &lt;- "____"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Use this <code>url</code> as the base url, <code>https://api.openweathermap.org/data/2.5/weather?</code> (Imporve Instructions using empty and fill)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="do">## EMPTY VERSION</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># current_weather_url &lt;- glue("____",                        ## Base URL / Endpoint</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">#                             "q=", URLencode(____),         ## City Name</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">#                             "&amp;appid=", Sys.getenv("____"), ## Use of API Key</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">#                             "&amp;units=____")                 ## Specify the units</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note:</p>
<ul>
<li><p><code>Endpoint</code>: The base URL that specifies the location of the API resource you want to access.</p></li>
<li><p><code>q</code>: The query parameter, used for the main search term (in this case, the city name).</p></li>
<li><p><code>appid</code>: The parameter for your unique API key, which is used to authenticate your request.</p></li>
<li><p><code>units=imperial</code>: A parameter that requests the API to return data in Imperial units (e.g., Fahrenheit).</p></li>
<li><p><code>URLencode()</code>: A function that formats text, like city names with spaces, to be safely included in a URL.</p></li>
<li><p><strong>imperial</strong>: A parameter that tells the API to return data in Imperial units (e.g., Fahrenheit).</p></li>
</ul>
<div style="height: 300px; background-color: white;">

</div>
<p>Print the <code>url</code> string</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="do">## EMPTY VERSION</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ____</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Make the request formal</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="do">## EMPTY VERSION</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># req &lt;- request(____)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Print the formal requst</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="do">## EMPTY VERSION</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ____</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note 13: Look at the request</p>
<ul>
<li>This method shows the <strong>anatomy of the URL</strong> explicitly.</li>
<li>Great for emphasizing how query parameters are constructed using strings.</li>
<li>Helps reinforce the idea of â€œasking a question via the URL.â€</li>
</ul>
<p>Note 14:</p>
<ul>
<li>We are going to do it again in a different way but we are going to process the response further here because
<ul>
<li>I wanted you to understand the anatomy of the URL</li>
<li>Have multiple ways of doing the same thing</li>
</ul></li>
</ul>
<div style="height: 300px; background-color: white;">

</div>
</section>
<section id="method-2-using-req_url_query" class="level4">
<h4 class="anchored" data-anchor-id="method-2-using-req_url_query"><strong>Method 2: Using <code>req_url_query()</code></strong></h4>
<p><strong>Step 1: Build Request Object</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="do">## EMPTY VERSION</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co"># req &lt;- request("____") %&gt;%  </span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   req_url_query(</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co">#     q = ____,</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co">#     appid = Sys.getenv("____"),</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co">#     units = "____"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="do">## EMPTY VERSION</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ____</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note 15:</p>
<ul>
<li>This method abstracts away the string building.</li>
<li>Itâ€™s cleaner and reduces chances of typos or formatting errors.</li>
<li>Teaches students to treat query arguments like named inputs.</li>
<li>You can still inspect the built URL using <code>req$url</code>.</li>
</ul>
<div style="height: 300px; background-color: white;">

</div>
<p><strong>Step 2: Make request</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="do">## EMPTY VERSION</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"># response &lt;- req_perform(____)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="do">## EMPTY VERSION</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ____</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><strong>GET</strong>: The method used to request data.</li>
<li><strong>URL</strong>: The full address the request was sent to.</li>
<li><strong>Status: 200 OK</strong>: The request was successful.</li>
<li><strong>Content-Type</strong>: The returned data is in JSON format.</li>
<li><strong>Body</strong>: The weather data is downloaded and in memory.</li>
</ul>
<p>Note 16:</p>
<ul>
<li><strong><code>GET</code></strong>: This indicates that the request method used was <code>GET</code>, which is used to retrieve data from a server.</li>
<li><strong>URL</strong>: This is the full web address the request was sent to, including the endpoint and all the query parameters (like the city, your API key, and the units).</li>
<li><strong><code>Status: 200 OK</code></strong>: This is the HTTP status code. A <code>200 OK</code> status means your request was successfully received, understood, and processed.</li>
<li><strong><code>Content-Type: application/json</code></strong>: This header tells you the format of the data in the response body. In this case, the weather data was sent back in <strong>JSON</strong> format.</li>
<li><strong><code>Body: In memory (514 bytes)</code></strong>: This confirms that the data returned by the API (the actual weather information) has been downloaded and is stored in your computerâ€™s memory, ready to be used.</li>
</ul>
<div style="height: 300px; background-color: white;">

</div>
<p><em>Not a step: View content Type</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="do">## EMPTY VERSION</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co"># content_type &lt;- resp_content_type(____)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="do">## EMPTY VERSION</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ____</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div style="height: 300px; background-color: white;">

</div>
<p><strong>Step 3: Process the Response</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="do">## EMPTY VERSION</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co"># library(____)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="do">## EMPTY VERSION</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="do">## IF the status code is 200 we are good</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co"># if (resp_status(____) == ____) {</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Parse JSON</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   result &lt;- resp_body_json(____)</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Print Results as JSON but in R it is a list</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="co">#   print(____)</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="co">#   #---------------------------------------</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Convert to Data Frame directly</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="co">#   current_weather_df &lt;- as.data.frame(____)</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Print Results as Data Frame, using dplyr</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a><span class="co">#   current_weather_df %&gt;% </span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="co">#     select(____, ____, ____, ____, ____) %&gt;% </span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="co">#     print()</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a><span class="co"># ## ELSE state there is an Error</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a><span class="co"># } else {</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a><span class="co">#   cat("Failed. Status code:", resp_status(____), "\n")</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note 18:</p>
<ul>
<li><p><strong>Select Key Information</strong>: The API gives us much more data than we need. We use <code>select()</code> from the <strong><code>dplyr</code></strong> library to pull out only the specific columns weâ€™re interested in, creating a clean, final table.</p></li>
<li><p><strong>Check for Success First</strong>: The <code>if (resp_status(response) == 200)</code> statement is crucial. Itâ€™s our safety check to make sure the request was successful before we try to use the data. If the status is anything else, our code prints an error and stops.</p></li>
<li><p><strong>Extract and Parse the Data</strong>: Once we confirm success, we use <code>resp_body_json()</code>. This function takes the raw body of the response, parses the <strong>JSON</strong> text, and converts it into a structured R <strong>list</strong>. This list contains all the weather data returned by the API.</p></li>
<li><p><strong>Convert to a Data Frame</strong>: While the list is useful, a data frame is often easier to work with. We use <code>as.data.frame()</code> to transform the nested list of weather data into a standard R data frame.</p></li>
</ul>
<div style="height: 300px; background-color: white;">

</div>
<p>####â€”â€”â€”â€”â€”â€”â€”</p>
</section>
<section id="q11." class="level4">
<h4 class="anchored" data-anchor-id="q11."><strong>Q11.</strong></h4>
<p><strong>(Open-Ended):</strong> In the final step of processing the response, the code uses <code>select()</code> to pick specific columns from the data frame. Why is this step almost always necessary after parsing a JSON response from an API?</p>
<p>####â€”â€”â€”â€”â€”â€”â€”</p>
</section>
</section>
<section id="lets-dissect-build-a-function-1" class="level3">
<h3 class="anchored" data-anchor-id="lets-dissect-build-a-function-1">13. Letâ€™s dissect &amp; build a function 1</h3>
<p>Provide instructions (Improve Instructions using empty and fill)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="do">## EMPTY VERSION</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Step 1: Define function "get_city_coords" that accepts the parameter "city"</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co"># get_city_coords &lt;- function(____){</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ## Step 2: Create API request URL</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   geo_url &lt;- glue(</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co">#     "____", # Endpoint</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co">#     "q=", URLencode(____),</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="co">#     "&amp;limit=1&amp;appid=", Sys.getenv("____")</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="co"># ## Step 3: Use req_perform() and request() to call the API with the URL request  </span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="co">#   geo_response &lt;- req_perform(request(____))</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="co"># ## Step 4: If the status code is 200 (OK), parse the response</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="co">#   if (resp_status(____) == ____) {</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="co">#     geo_data_df &lt;- resp_body_json(____) %&gt;% </span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="co">#       as.data.frame()</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a><span class="co">#     </span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a><span class="co">#   ## Step 5: Assess if the output has 0 length, meaning no result.</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a><span class="co">#     if (length(____) == 0) {</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a><span class="co">#       stop("____")</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a><span class="co">#     }</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a><span class="co">#     </span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a><span class="co">#   ## Step 6: Round latitude and longitude to 2 decimal places.</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a><span class="co">#     mod_1_geo_data_df &lt;- geo_data_df %&gt;% </span></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a><span class="co">#       mutate(lat = round(____, 2),</span></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a><span class="co">#              lon = round(____, 2))</span></span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a><span class="co">#   ## Step 7: Select and rename columns</span></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a><span class="co">#     mod_2_geo_data_df &lt;- mod_1_geo_data_df %&gt;% </span></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a><span class="co">#       select(____, ____, ____, ____) %&gt;% </span></span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a><span class="co">#       rename(city = ____)</span></span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a><span class="co">#     </span></span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a><span class="co">#   ## Step 8: Return the final data frame</span></span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a><span class="co">#     return(____)</span></span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a><span class="co">#     </span></span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a><span class="co">#   }</span></span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note 20:</p>
<p>Explain the function and fill in blanks Emphasize error handling</p>
<div style="height: 300px; background-color: white;">

</div>
<p>Lets try out this new function on the city</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="do">## EMPTY VERSION</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co"># get_city_coords(____)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note 21: Explain output</p>
<p>Lets Look at multiple cities using the the map_df function within the purrr package Provide instructions (Improve Instructions using empty and fill)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="do">## EMPTY VERSION</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co"># library(____)</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># # List of cities you want to geocode</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co"># cities &lt;- c("San Luis Obispo", "Chicago", "New York", "Atlanta", "Houston", "Des Moines")</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co"># # Use map_df() to apply the function to each city</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co"># map_df(____, ____)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note 22: Explain Task Explain <code>map_df</code> Explain output</p>
<div style="height: 300px; background-color: white;">

</div>
<p>####â€”â€”â€”â€”â€”â€”â€”</p>
<section id="q12." class="level4">
<h4 class="anchored" data-anchor-id="q12.">Q12.</h4>
<p><strong>(Discussion):</strong> In section 13, we put the API logic inside a function (<code>get_city_coords</code>) and then used <code>map_df</code> to call it. What are the key advantages of this â€œfunctionalâ€ approach compared to copying and pasting the API request code for every city in our list? âš™ï¸</p>
<p>####â€”â€”â€”â€”â€”â€”â€”</p>
</section>
</section>
<section id="lets-dissect-build-a-function-2" class="level3">
<h3 class="anchored" data-anchor-id="lets-dissect-build-a-function-2">14. Letâ€™s dissect &amp; build a function 2</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="do">## EMPTY VERSION</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co"># library(____) ## Time related Package</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note 23: Explain need for lubridate Emphasize the new endpoint (<code>https://api.openweathermap.org/data/3.0/onecall/day_summary?</code>) an how it is a paid subscription</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="do">## EMPTY VERSION</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co"># get_past_weather_by_city &lt;- function(____, ____) {</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Step 1: Get city coordinates</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   coords_df &lt;- get_city_coords(____)</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   lat &lt;- coords_df$lat</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   lon &lt;- coords_df$lon</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   cat("Coordinates for", city, "-&gt; Latitude:", lat, "Longitude:", lon, "\n")</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Step 2: Create vector of past dates</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="co">#   date_range &lt;- as.character(today() - days(1:____))</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Step 3: Define function for single date</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="co">#   fetch_day_summary &lt;- function(____) {</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="co">#     weather_url &lt;- glue(</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a><span class="co">#       "____", # Endpoint</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a><span class="co">#       "lat=", ____,</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a><span class="co">#       "&amp;lon=", ____,</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a><span class="co">#       "&amp;date=", ____,</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a><span class="co">#       "&amp;appid=", Sys.getenv("____"),</span></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a><span class="co">#       "&amp;units=imperial"</span></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a><span class="co">#     )</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a><span class="co">#     </span></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a><span class="co">#     response &lt;- req_perform(request(____))</span></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a><span class="co">#     </span></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a><span class="co">#     if (resp_status(____) == 200) {</span></span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a><span class="co">#       resp_body_json(____) %&gt;% </span></span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a><span class="co">#         as.data.frame() %&gt;% </span></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a><span class="co">#         mutate(city = ____, date = ____)</span></span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a><span class="co">#     } else {</span></span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a><span class="co">#       warning(paste("Failed to get weather for", date, "-", resp_status(response)))</span></span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a><span class="co">#       return(NULL)</span></span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a><span class="co">#     }</span></span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a><span class="co">#   }</span></span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Step 4: Map over date_range and bind into a single data frame</span></span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a><span class="co">#   map_dfr(____, ____)</span></span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>`</p>
<p>Note 24: (Explanation of filling out code and what code does)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="do">## EMPTY VERSION</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co"># get_past_weather_by_city(____, ____)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note 25: Explain code and output</p>
<div style="height: 300px; background-color: white;">

</div>
<p><strong>There are alot of ways of doing this, I decided not to use for loop in R</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="do">## EMPTY VERSION</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co"># num_days &lt;- 5</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># # Get historical weather data for each city using map_dfr</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co"># all_weather_df &lt;- map_dfr(</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   ____,</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   ~ get_past_weather_by_city(____, ____)</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note 26: (Explanation of <code>map_dfr</code> and each element of input)</p>
<p>####â€”â€”â€”â€”â€”â€”â€”</p>
<section id="q13." class="level4">
<h4 class="anchored" data-anchor-id="q13."><strong>Q13.</strong></h4>
<p><strong>(Open-Ended):</strong> The final function, <code>get_past_weather_by_city</code>, contains a â€œnestedâ€ helper function inside it called <code>fetch_day_summary</code>. What is the purpose of structuring the code this way?</p>
<p>####â€”â€”â€”â€”â€”â€”â€”</p>
<hr>
</section>
</section>
</section>
<section id="part-3.-hands-on-activities" class="level2">
<h2 class="anchored" data-anchor-id="part-3.-hands-on-activities">Part 3. Hands on Activities</h2>
<p><strong>GENERAL INSRUCTIONS</strong></p>
<p><em>Read the following instructions and complete the activity</em></p>
<p>In this section, we will put our knowledge into practice by building three distinct functions from the ground up. Each function will call a different OpenWeatherMap API endpoint, demonstrating how to retrieve current weather, 5-day forecasts, and air pollution data. For each activity, you will be provided with a fill-in-the-blank template and the final solution.</p>
<section id="hands-activity-1get_city_current_weather" class="level4">
<h4 class="anchored" data-anchor-id="hands-activity-1get_city_current_weather">Hands Activity 1:<code>get_city_current_weather()</code></h4>
<p>Our first task is to create a function that retrieves the <strong>current weather conditions</strong> for a single city. This activity demonstrates a basic <code>GET</code> request and how to parse a relatively simple, â€œflatâ€ JSON structure. Notice the endpoint we are using for this task.</p>
<p><strong>Endpoint:</strong> <code>https://api.openweathermap.org/data/2.5/weather?</code></p>
<p><strong>Step 1: Retrieves <em>current weather conditions</em> for a single city. Demonstrates basic <code>GET</code> usage and parsing a flat JSON structure.</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="do">## EMPTY VERSION</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co"># get_city_current_weather &lt;- function(____) {</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   url &lt;- glue::glue(</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co">#     "____", # Endpoint</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co">#     "q=", URLencode(____),</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="co">#     "&amp;appid=", Sys.getenv("____"),</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co">#     "&amp;units=imperial"</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   response &lt;- request(____) %&gt;%</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="co">#     req_perform()</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="co">#   if (resp_status(____) == 200) {</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="co">#     response %&gt;% </span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="co">#       resp_body_json() %&gt;% </span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="co">#       purrr::pluck("____") %&gt;% </span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a><span class="co">#       tibble::as_tibble() %&gt;% </span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a><span class="co">#       dplyr::select(____, ____) %&gt;% </span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a><span class="co">#       dplyr::mutate(</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a><span class="co">#         city = ____,</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a><span class="co">#         description = resp_body_json(____) %&gt;%</span></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a><span class="co">#           pluck("____", 1, "____")</span></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a><span class="co">#       ) %&gt;% </span></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a><span class="co">#       dplyr::select(____, ____, ____, ____)</span></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a><span class="co">#   } else {</span></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a><span class="co">#     warning("Failed to retrieve current weather for ", ____)</span></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a><span class="co">#     return(NULL)</span></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a><span class="co">#   }</span></span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div style="height: 300px; background-color: white;">

</div>
<p><strong>Step 2: Run for a Single City (e.g., â€œAtlantaâ€)</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="do">## EMPTY VERSION</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co"># get_city_current_weather("____")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Step 3: Run for a Vector of Cities Using <code>purrr::map_dfr()</code></strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="do">## EMPTY VERSION</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co"># cities &lt;-  c("San Francisco", "Minneapolis", "St. Louis", "Savannah", "Boulder", "Washington D.C.", "Kansas City", "Orlando")</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co"># weather_df &lt;- purrr::map_dfr(____, ____)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div style="height: 300px; background-color: white;">

</div>
</section>
<section id="hands-activity-2-get_city_forecast_5day" class="level4">
<h4 class="anchored" data-anchor-id="hands-activity-2-get_city_forecast_5day">Hands Activity 2: <code>get_city_forecast_5day()</code></h4>
<p>Next, weâ€™ll create a function to retrieve the <strong>5-day weather forecast</strong>. This task is more complex because the API returns a <em>nested list</em> of dataâ€”one for each 3-hour interval. This will give us practice flattening complex JSON structures into a tidy data frame. Note the new endpoint weâ€™re using; changing a single word from <code>/weather</code> to <code>/forecast</code> requests entirely different information.</p>
<p><strong>Endpoint:</strong> <code>https://api.openweathermap.org/data/2.5/forecast?</code></p>
<p><strong>Purpose:</strong> Retrieves the <em>next 5 days of forecast data</em> (in 3-hour intervals). This introduces nested lists and flattening structures.</p>
<p>Note: we are now getting times as well</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="do">## EMPTY VERSION</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="co"># get_city_forecast_5day &lt;- function(____) {</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   url &lt;- glue::glue(</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co">#     "____", # Endpoint</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co">#     "q=", URLencode(____),</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="co">#     "&amp;appid=", Sys.getenv("____"),</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="co">#     "&amp;units=imperial"</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   response &lt;- httr2::req_perform(httr2::request(____))</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="co">#   if (httr2::resp_status(____) == 200) {</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="co">#     response %&gt;% </span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="co">#       resp_body_json() %&gt;% </span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="co">#       purrr::pluck("____") %&gt;% </span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a><span class="co">#       purrr::map_dfr(</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a><span class="co">#         ~ tibble::tibble(</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a><span class="co">#             city = ____,</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a><span class="co">#             timestamp = .x$____,</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a><span class="co">#             temp = .x$____$____,</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a><span class="co">#             weather = .x$____ %&gt;% purrr::pluck(1, "____")</span></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a><span class="co">#         )</span></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a><span class="co">#       )</span></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a><span class="co">#   } else {</span></span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a><span class="co">#     warning("Failed to retrieve forecast for ", ____)</span></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a><span class="co">#     return(NULL)</span></span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a><span class="co">#   }</span></span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div style="height: 300px; background-color: white;">

</div>
<p><strong>Try for city notice the number of rows and columns</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="do">## EMPTY VERSION</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co"># get_city_forecast_5day("____")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Lets Look at multiple cities</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="do">## EMPTY VERSION</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="co"># cities &lt;- c("Portland", "Salt Lake City", "Philadelphia", "Charleston", "Detroit", "Las Vegas", "San Diego", "Baltimore")</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># forecast_df &lt;- purrr::map_dfr(____, ____)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div style="height: 300px; background-color: white;">

</div>
</section>
<section id="hands-activity-3-get_air_pollution_by_coordslat-lon" class="level4">
<h4 class="anchored" data-anchor-id="hands-activity-3-get_air_pollution_by_coordslat-lon">Hands Activity 3: <code>get_air_pollution_by_coords(lat, lon)</code></h4>
<p>For our final activity, weâ€™ll get <strong>current air pollution data</strong>. This demonstrates two important concepts: using different query parameters (latitude and longitude instead of a city name) and the power of <strong>chaining API requests</strong>. We will first need to get coordinates for a city before we can ask the air pollution endpoint for data. Pay close attention to this new endpoint and the parameters it requires.</p>
<p><strong>Endpoint:</strong> <code>http://api.openweathermap.org/data/2.5/air_pollution?</code></p>
<p><strong>Purpose:</strong> Uses <code>lat</code> and <code>lon</code> to query <em>current air quality</em>. Demonstrates chaining of API requests (e.g., using <code>get_city_coords()</code> first), and different JSON structures.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="do">## EMPTY VERSION</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co"># get_air_pollution_by_coords &lt;- function(____, ____) {</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   url &lt;- glue::glue(</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co">#     "____", # Endpoint</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co">#     "lat=", ____,</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co">#     "&amp;lon=", ____,</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co">#     "&amp;appid=", Sys.getenv("____")</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   response &lt;- request(____) %&gt;% req_perform()</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="co">#   if (resp_status(____) == 200) {</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="co">#     response %&gt;%</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a><span class="co">#       resp_body_json() %&gt;%</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a><span class="co">#       purrr::pluck("____", 1) %&gt;%</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a><span class="co">#       {\(x) tibble::tibble(</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a><span class="co">#           aqi = x$____$____,</span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a><span class="co">#           co = x$____$____,</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a><span class="co">#           pm2_5 = x$____$____,</span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a><span class="co">#           pm10 = x$____$____</span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a><span class="co">#       )}()</span></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a><span class="co">#   } else {</span></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a><span class="co">#     warning("Failed to retrieve air pollution data for lat = ", lat, ", lon = ", lon)</span></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a><span class="co">#     return(NULL)</span></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a><span class="co">#   }</span></span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div style="height: 300px; background-color: white;">

</div>
<p>Step-by-Step for Usage with a Data Frame, use <code>get_city_coords</code> to get the cities of <code>lon</code> and <code>lat</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="do">## EMPTY VERSION</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="co"># cities &lt;-  c("Seattle", "Denver", "Boston", "Austin", "New Orleans", "Miami", "Phoenix", "Nashville")</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co"># city_coords_df &lt;- map_dfr(____, ____)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Get Air Pollution Data for All Cities</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="do">## EMPTY VERSION</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co"># library(____) ## tidyr</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="do">## EMPTY VERSION</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="co"># pollution_df &lt;- city_coords_df %&gt;% </span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co">#     pollution = map2(____, ____, ____)</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) %&gt;% </span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   unnest(____)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="part-4.-reflection" class="level2">
<h2 class="anchored" data-anchor-id="part-4.-reflection">Part 4. Reflection</h2>
<ol type="1">
<li><p>Now that you have hands-on experience with the OpenWeather API, what is another type of real-world data you are curious about? What kind of API (e.g., sports, finance, social media, government) would you search for to start a project with that data? Why?</p></li>
<li><p>This session emphasized writing reusable functions (<code>get_city_coords</code>, <code>get_city_current_weather</code>, etc.). How does this practice change how you would approach a task that involves fetching data for 100 different cities versus just one or two?</p></li>
<li><p>Think about the different parts of an API request you built today: the endpoint URL, the query parameters (like <code>q=</code> or <code>lat=</code>), and the API key. If your script suddenly failed, which of these components would you check first to debug the problem, and why?</p></li>
<li><p>What was the most challenging or surprising part of turning the theoretical diagram of an API call into actual, working R code? What concept â€œclickedâ€ for you during the hands-on activities?</p></li>
</ol>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>